"use strict";(globalThis.webpackChunkcoo_llm_docs=globalThis.webpackChunkcoo_llm_docs||[]).push([[3793],{6023:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"Reference/Logging/Usage-Logging","title":"Usage Logging","description":"Detailed logging of internal operations including store interactions and usage tracking.","source":"@site/content/Reference/Logging/Usage-Logging.md","sourceDirName":"Reference/Logging","slug":"/Reference/Logging/Usage-Logging","permalink":"/docs/docs/Reference/Logging/Usage-Logging","draft":false,"unlisted":false,"editUrl":"https://github.com/coo-llm/coo-llm-main/tree/main/docs/content/content/Reference/Logging/Usage-Logging.md","tags":[{"inline":true,"label":"reference","permalink":"/docs/docs/tags/reference"},{"inline":true,"label":"logging","permalink":"/docs/docs/tags/logging"},{"inline":true,"label":"usage","permalink":"/docs/docs/tags/usage"},{"inline":true,"label":"metrics","permalink":"/docs/docs/tags/metrics"}],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"tags":["reference","logging","usage","metrics"]},"sidebar":"tutorialSidebar","previous":{"title":"Request Logging","permalink":"/docs/docs/Reference/Logging/Request-Logging"},"next":{"title":"Prometheus Metrics","permalink":"/docs/docs/Reference/Logging/Prometheus"}}');var s=r(4848),l=r(8453);const t={sidebar_position:2,tags:["reference","logging","usage","metrics"]},o="Usage Logging",c={},a=[{value:"Usage Log Structure",id:"usage-log-structure",level:2},{value:"Field Descriptions",id:"field-descriptions",level:2},{value:"Metrics Types",id:"metrics-types",level:2},{value:"Request Metrics",id:"request-metrics",level:3},{value:"Token Metrics",id:"token-metrics",level:3},{value:"Error Metrics",id:"error-metrics",level:3},{value:"Latency Metrics",id:"latency-metrics",level:3},{value:"Usage Analysis",id:"usage-analysis",level:2},{value:"Aggregation Queries",id:"aggregation-queries",level:3},{value:"Real-time Monitoring",id:"real-time-monitoring",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Performance Impact",id:"performance-impact",level:2}];function g(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"usage-logging",children:"Usage Logging"})}),"\n",(0,s.jsx)(n.p,{children:"Detailed logging of internal operations including store interactions and usage tracking."}),"\n",(0,s.jsx)(n.h2,{id:"usage-log-structure",children:"Usage Log Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "level": "debug",\n  "operation": "IncrementUsage",\n  "provider": "gemini-prod",\n  "keyID": "gemini-prod-9987861163793b2d",\n  "metric": "req",\n  "delta": 1,\n  "time": "2025-10-18T10:10:37+07:00",\n  "message": "store operation"\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"field-descriptions",children:"Field Descriptions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"level"}),": Always ",(0,s.jsx)(n.code,{children:"debug"})," for usage logs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"operation"}),": Store operation type","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"IncrementUsage"}),": Usage counter increment"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SetUsage"}),": Usage value setting"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GetUsage"}),": Usage value retrieval"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"provider"}),": Provider identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"keyID"}),": Hashed key identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"metric"}),": Usage metric type","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"req"}),": API requests"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"tokens"}),": Token usage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"errors"}),": Error count"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"latency"}),": Response time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cost"}),": Cost tracking"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"delta"}),": Change amount (for increments)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"time"}),": Operation timestamp"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"message"}),": Always ",(0,s.jsx)(n.code,{children:'"store operation"'})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"metrics-types",children:"Metrics Types"}),"\n",(0,s.jsx)(n.h3,{id:"request-metrics",children:"Request Metrics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "operation": "IncrementUsage",\n  "metric": "req",\n  "delta": 1\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"token-metrics",children:"Token Metrics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "operation": "IncrementUsage", \n  "metric": "tokens",\n  "delta": 150\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"error-metrics",children:"Error Metrics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "operation": "IncrementUsage",\n  "metric": "errors", \n  "delta": 1\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"latency-metrics",children:"Latency Metrics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "operation": "IncrementUsage",\n  "metric": "latency",\n  "delta": 1250\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"usage-analysis",children:"Usage Analysis"}),"\n",(0,s.jsx)(n.h3,{id:"aggregation-queries",children:"Aggregation Queries"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Total requests by provider\ngrep \'"operation":"IncrementUsage"\' logs/llm.log | grep \'"metric":"req"\' | jq -r \'.provider\' | sort | uniq -c\n\n# Total tokens used\ngrep \'"operation":"IncrementUsage"\' logs/llm.log | grep \'"metric":"tokens"\' | jq \'.delta\' | paste -sd+ | bc\n\n# Error rate calculation\ntotal_req=$(grep \'"metric":"req"\' logs/llm.log | wc -l)\ntotal_err=$(grep \'"metric":"errors"\' logs/llm.log | wc -l)\necho "scale=2; $total_err / $total_req * 100" | bc\n'})}),"\n",(0,s.jsx)(n.h3,{id:"real-time-monitoring",children:"Real-time Monitoring"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Watch live usage\ntail -f logs/llm.log | grep \'"operation":"IncrementUsage"\' | jq \'.\'\n\n# Monitor specific provider\ntail -f logs/llm.log | grep \'"provider":"openai"\' | grep \'"metric":"req"\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Usage logs are always enabled at debug level:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'logging:\n  level: "debug"  # Required for usage logs\n'})}),"\n",(0,s.jsx)(n.h2,{id:"performance-impact",children:"Performance Impact"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Low Overhead"}),": Efficient JSON serialization"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Async Writing"}),": Non-blocking log operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Buffered Output"}),": Batched writes for performance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configurable"}),": Can be disabled by log level"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(g,{...e})}):g(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>o});var i=r(6540);const s={},l=i.createContext(s);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);