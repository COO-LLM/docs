"use strict";(globalThis.webpackChunkcoo_llm_docs=globalThis.webpackChunkcoo_llm_docs||[]).push([[7064],{3328:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Reference/Logging/Prometheus","title":"Prometheus Metrics","description":"COO-LLM exposes comprehensive metrics for monitoring via Prometheus-compatible endpoint.","source":"@site/content/Reference/Logging/Prometheus.md","sourceDirName":"Reference/Logging","slug":"/Reference/Logging/Prometheus","permalink":"/docs/docs/Reference/Logging/Prometheus","draft":false,"unlisted":false,"editUrl":"https://github.com/coo-llm/coo-llm-main/tree/main/docs/content/content/Reference/Logging/Prometheus.md","tags":[{"inline":true,"label":"reference","permalink":"/docs/docs/tags/reference"},{"inline":true,"label":"logging","permalink":"/docs/docs/tags/logging"},{"inline":true,"label":"prometheus","permalink":"/docs/docs/tags/prometheus"},{"inline":true,"label":"metrics","permalink":"/docs/docs/tags/metrics"}],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"tags":["reference","logging","prometheus","metrics"]},"sidebar":"tutorialSidebar","previous":{"title":"Usage Logging","permalink":"/docs/docs/Reference/Logging/Usage-Logging"},"next":{"title":"Testing","permalink":"/docs/docs/Developer-Guide/Testing"}}');var l=r(4848),t=r(8453);const i={sidebar_position:3,tags:["reference","logging","prometheus","metrics"]},o="Prometheus Metrics",a={},c=[{value:"Endpoint",id:"endpoint",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Available Metrics",id:"available-metrics",level:2},{value:"Request Metrics",id:"request-metrics",level:3},{value:"Token Metrics",id:"token-metrics",level:3},{value:"Cost Metrics",id:"cost-metrics",level:3},{value:"Error Metrics",id:"error-metrics",level:3},{value:"Active Connections",id:"active-connections",level:3},{value:"Query Examples",id:"query-examples",level:2},{value:"Request Rate",id:"request-rate",level:3},{value:"Error Rate",id:"error-rate",level:3},{value:"Latency",id:"latency",level:3},{value:"Cost Tracking",id:"cost-tracking",level:3},{value:"Token Usage",id:"token-usage",level:3},{value:"Alerting Rules",id:"alerting-rules",level:2},{value:"Dashboard Examples",id:"dashboard-examples",level:2},{value:"Grafana Dashboard JSON",id:"grafana-dashboard-json",level:3},{value:"Integration",id:"integration",level:2},{value:"Prometheus Configuration",id:"prometheus-configuration",level:3},{value:"Grafana Data Source",id:"grafana-data-source",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"prometheus-metrics",children:"Prometheus Metrics"})}),"\n",(0,l.jsx)(n.p,{children:"COO-LLM exposes comprehensive metrics for monitoring via Prometheus-compatible endpoint."}),"\n",(0,l.jsx)(n.h2,{id:"endpoint",children:"Endpoint"}),"\n",(0,l.jsxs)(n.p,{children:["Metrics are available at ",(0,l.jsx)(n.code,{children:"/api/metrics"})," when enabled."]}),"\n",(0,l.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'logging:\n  prometheus:\n    enabled: true\n    endpoint: "/api/metrics"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"available-metrics",children:"Available Metrics"}),"\n",(0,l.jsx)(n.h3,{id:"request-metrics",children:"Request Metrics"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"llm_requests_total"}),": Total number of LLM requests"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Type: Counter"}),"\n",(0,l.jsxs)(n.li,{children:["Labels: ",(0,l.jsx)(n.code,{children:"provider"}),", ",(0,l.jsx)(n.code,{children:"model"}),", ",(0,l.jsx)(n.code,{children:"key"}),", ",(0,l.jsx)(n.code,{children:"client_key"})]}),"\n",(0,l.jsxs)(n.li,{children:["Example: ",(0,l.jsx)(n.code,{children:'llm_requests_total{provider="openai",model="gpt-4o"} 1250'})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"llm_request_duration_seconds"}),": Request duration in seconds"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Type: Histogram"}),"\n",(0,l.jsxs)(n.li,{children:["Labels: ",(0,l.jsx)(n.code,{children:"provider"}),", ",(0,l.jsx)(n.code,{children:"model"}),", ",(0,l.jsx)(n.code,{children:"key"}),", ",(0,l.jsx)(n.code,{children:"client_key"})]}),"\n",(0,l.jsx)(n.li,{children:"Buckets: 0.1, 0.5, 1, 2.5, 5, 10, 30, 60"}),"\n",(0,l.jsxs)(n.li,{children:["Example: ",(0,l.jsx)(n.code,{children:'llm_request_duration_seconds_bucket{provider="openai",le="1"} 1200'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"token-metrics",children:"Token Metrics"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"llm_tokens_total"}),": Total token usage","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Type: Counter"}),"\n",(0,l.jsxs)(n.li,{children:["Labels: ",(0,l.jsx)(n.code,{children:"provider"}),", ",(0,l.jsx)(n.code,{children:"model"}),", ",(0,l.jsx)(n.code,{children:"key"}),", ",(0,l.jsx)(n.code,{children:"client_key"}),", ",(0,l.jsx)(n.code,{children:"type"})," (input/output)"]}),"\n",(0,l.jsxs)(n.li,{children:["Example: ",(0,l.jsx)(n.code,{children:'llm_tokens_total{provider="openai",type="input"} 150000'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"cost-metrics",children:"Cost Metrics"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"llm_cost_total"}),": Total cost incurred","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Type: Counter"}),"\n",(0,l.jsxs)(n.li,{children:["Labels: ",(0,l.jsx)(n.code,{children:"provider"}),", ",(0,l.jsx)(n.code,{children:"model"}),", ",(0,l.jsx)(n.code,{children:"key"}),", ",(0,l.jsx)(n.code,{children:"client_key"})]}),"\n",(0,l.jsxs)(n.li,{children:["Example: ",(0,l.jsx)(n.code,{children:'llm_cost_total{provider="openai"} 25.50'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"error-metrics",children:"Error Metrics"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"llm_errors_total"}),": Total number of errors","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Type: Counter"}),"\n",(0,l.jsxs)(n.li,{children:["Labels: ",(0,l.jsx)(n.code,{children:"provider"}),", ",(0,l.jsx)(n.code,{children:"model"}),", ",(0,l.jsx)(n.code,{children:"key"}),", ",(0,l.jsx)(n.code,{children:"client_key"}),", ",(0,l.jsx)(n.code,{children:"type"})]}),"\n",(0,l.jsxs)(n.li,{children:["Example: ",(0,l.jsx)(n.code,{children:'llm_errors_total{provider="openai",type="rate_limit"} 5'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"active-connections",children:"Active Connections"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"llm_active_connections"}),": Current active connections","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Type: Gauge"}),"\n",(0,l.jsxs)(n.li,{children:["Labels: ",(0,l.jsx)(n.code,{children:"provider"})]}),"\n",(0,l.jsxs)(n.li,{children:["Example: ",(0,l.jsx)(n.code,{children:'llm_active_connections{provider="openai"} 3'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"query-examples",children:"Query Examples"}),"\n",(0,l.jsx)(n.h3,{id:"request-rate",children:"Request Rate"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-promql",children:"# Requests per second by provider\nrate(llm_requests_total[5m])\n\n# Requests per minute\nrate(llm_requests_total[1m])\n"})}),"\n",(0,l.jsx)(n.h3,{id:"error-rate",children:"Error Rate"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-promql",children:"# Error percentage\nrate(llm_errors_total[5m]) / rate(llm_requests_total[5m]) * 100\n"})}),"\n",(0,l.jsx)(n.h3,{id:"latency",children:"Latency"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-promql",children:"# 95th percentile latency\nhistogram_quantile(0.95, rate(llm_request_duration_seconds_bucket[5m]))\n\n# Average latency\nrate(llm_request_duration_seconds_sum[5m]) / rate(llm_request_duration_seconds_count[5m])\n"})}),"\n",(0,l.jsx)(n.h3,{id:"cost-tracking",children:"Cost Tracking"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-promql",children:"# Cost per hour\nincrease(llm_cost_total[1h])\n\n# Cost by provider\nsum(increase(llm_cost_total[1h])) by (provider)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"token-usage",children:"Token Usage"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-promql",children:'# Tokens per minute\nrate(llm_tokens_total[1m])\n\n# Input vs output tokens\nrate(llm_tokens_total{type="input"}[5m]) / rate(llm_tokens_total{type="output"}[5m])\n'})}),"\n",(0,l.jsx)(n.h2,{id:"alerting-rules",children:"Alerting Rules"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'groups:\n  - name: coo-llm\n    rules:\n      - alert: HighErrorRate\n        expr: rate(llm_errors_total[5m]) / rate(llm_requests_total[5m]) > 0.1\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "High error rate detected"\n\n      - alert: HighLatency\n        expr: histogram_quantile(0.95, rate(llm_request_duration_seconds_bucket[5m])) > 30\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "High latency detected"\n\n      - alert: RateLimitHit\n        expr: increase(llm_errors_total{type="rate_limit"}[5m]) > 10\n        for: 2m\n        labels:\n          severity: info\n        annotations:\n          summary: "Rate limit exceeded"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"dashboard-examples",children:"Dashboard Examples"}),"\n",(0,l.jsx)(n.h3,{id:"grafana-dashboard-json",children:"Grafana Dashboard JSON"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "dashboard": {\n    "title": "COO-LLM Metrics",\n    "panels": [\n      {\n        "title": "Request Rate",\n        "type": "graph",\n        "targets": [\n          {\n            "expr": "rate(llm_requests_total[5m])",\n            "legendFormat": "{{provider}}"\n          }\n        ]\n      },\n      {\n        "title": "Error Rate",\n        "type": "graph", \n        "targets": [\n          {\n            "expr": "rate(llm_errors_total[5m]) / rate(llm_requests_total[5m]) * 100",\n            "legendFormat": "{{provider}} error %"\n          }\n        ]\n      },\n      {\n        "title": "Latency P95",\n        "type": "graph",\n        "targets": [\n          {\n            "expr": "histogram_quantile(0.95, rate(llm_request_duration_seconds_bucket[5m]))",\n            "legendFormat": "{{provider}} p95"\n          }\n        ]\n      }\n    ]\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"integration",children:"Integration"}),"\n",(0,l.jsx)(n.h3,{id:"prometheus-configuration",children:"Prometheus Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"scrape_configs:\n  - job_name: 'coo-llm'\n    static_configs:\n      - targets: ['localhost:2906']\n    metrics_path: '/api/metrics'\n"})}),"\n",(0,l.jsx)(n.h3,{id:"grafana-data-source",children:"Grafana Data Source"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "COO-LLM Prometheus",\n  "type": "prometheus",\n  "url": "http://prometheus:9090",\n  "access": "proxy"\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var s=r(6540);const l={},t=s.createContext(l);function i(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);